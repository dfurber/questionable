import{jsx as e,Fragment as t,jsxs as n}from"react/jsx-runtime";import{createContext as r,useState as i,useContext as o,useReducer as a}from"react";import{useWizard as s}from"use-wizard";import{merge as c,values as u,kebabCase as l,capitalize as d}from"lodash";import{Button as v,CardGroup as f,Card as p,CardHeader as g,CardBody as b,CardFooter as h,Radio as y,Fieldset as O,Checkbox as m,SummaryBox as j,DateInputGroup as w,DateInput as S,Accordion as E,StepIndicator as P,StepIndicatorStep as D}from"@trussworks/react-uswds";import{DateTime as N}from"luxon";import I from"moment";function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C,_;!function(e){e.DOB="dob",e.MULTIPLE_CHOICE="multiple_choice",e.MULTIPLE_SELECT="multiple_select"}(C||(C={})),function(e){e.LANDING="Landing",e.NO_RESULTS="No Results",e.RESULTS="Results",e.SUMMARY="Summary"}(_||(_={}));var x,U,M,F,B,H,Y=A(A({},_),C);!function(e){e[e.FORWARD=1]="FORWARD",e[e.BACKWARD=-1]="BACKWARD"}(x||(x={})),function(e){e.COMPLETE="complete",e.CURRENT="current"}(U||(U={})),function(e){e.CALL="call",e.HYBRID="hybrid",e.ONLINE="online"}(M||(M={})),function(e){e.RESET="RESET",e.UPDATE="UPDATE"}(F||(F={})),function(e){e.DAY="day",e.MONTH="month",e.YEAR="year"}(B||(B={})),function(e){e.EDIT="edit",e.VIEW="view"}(H||(H={}));var q=function(e,t){return Object.values(e).includes(t)};function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var z=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Q(this,e),R(this,"started",void 0),R(this,"finished",void 0),R(this,"birthdate",void 0),R(this,"age",void 0),R(this,"answers",{}),Object.assign(this,t),this.started=new Date};function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=function(e,t){switch(null==t?void 0:t.type){case F.RESET:return new z;case F.UPDATE:return c(V({},e),V({},t.value));default:return e}},J=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log([].concat(t))},K=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return J("Created an empty element",n,r),e(t,{children:n},void 0)},$=r({setState:{},state:{}}),X=function(){var e=o($);if(!e)throw new Error("useGlobalState must be used within a GlobalStateContext");return e},Z=function(t){var n=t.children,r=t.value,o=k(i(void 0===r?{}:r),2),a=o[0],s=o[1];return e($.Provider,Object.assign({value:{setState:s,state:a}},{children:n}),void 0)},ee=function(){var e=X().state.questionnaire;if(!e)throw new Error("useQuestionnaire has no data");return e},te=function(){var e=X().state.config;if(!e)throw new Error("useConfig has no data");return e},ne=function(){return{config:te(),questionnaire:ee()}};function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e,t,n){return t&&re(e.prototype,t),n&&re(e,n),e}var oe=function(){function e(){Q(this,e)}return ie(e,null,[{key:"goToStep",value:function(e,t){t.wizard.goToStep(e)}},{key:"goToNextStep",value:function(t,n){e.goToStep(n.getNextStep(t),t)}},{key:"goToPrevStep",value:function(t,n){e.goToStep(n.getPreviousStep(t),t)}},{key:"isNextEnabled",value:function(t){var n,r,i;if(null==t||!t.step)throw new Error("This survery is not defined");return t.stepId===Y.LANDING||(t.stepId===Y.SUMMARY||!!t.form&&((null===(n=t.step)||void 0===n?void 0:n.type)===C.DOB?void 0!==(null===(r=t.form)||void 0===r||null===(i=r.age)||void 0===i?void 0:i.years)&&t.form.age.years>=0:e.isValid(t.form,t.step.id)))}},{key:"isValid",value:function(e,t){var n;if(!e.answers[t])return!1;var r=e.answers[t],i=u(r.answers);switch(r.type){case Y.DOB:return void 0!==(null==e||null===(n=e.age)||void 0===n?void 0:n.years)&&e.age.years>0;case Y.MULTIPLE_CHOICE:return void 0!==r.answer&&-1!==(null==i?void 0:i.indexOf(r.answer));default:return!0}}},{key:"getFieldSetName",value:function(e){return l(e.step.title)}},{key:"getDomId",value:function(t,n){var r=e.getFieldSetName(n);return"".concat(r,"-").concat(l(t))}}]),e}(),ae=function(t){var r,i,o,a,s=ne().questionnaire,c=t.step,u=t.stepId!==Y.LANDING&&t.stepId!==Y.RESULTS&&t.stepId!==Y.NO_RESULTS&&t.stepId!==s.flow[1],l=t.stepId!==Y.RESULTS&&t.stepId!==Y.NO_RESULTS,d=(null==c||null===(r=c.buttons)||void 0===r||null===(i=r.prev)||void 0===i?void 0:i.label)||"Previous",f=(null==c||null===(o=c.buttons)||void 0===o||null===(a=o.next)||void 0===a?void 0:a.label)||"Next";return n("nav",Object.assign({className:"wizard-layout__navbar"},{children:[u&&e(v,Object.assign({type:"button",outline:!0,onClick:function(){return oe.goToPrevStep(t,s)},"data-testid":"prev-button-".concat(t.stepId)},{children:d}),void 0),!u&&e("div",{},void 0),l&&e(v,Object.assign({type:"button",onClick:function(){return oe.goToNextStep(t,s)},disabled:!oe.isNextEnabled(t),"data-testid":"next-button-".concat(t.stepId)},{children:f}),void 0),!l&&e("div",{},void 0)]}),void 0)},se=function(){function t(){Q(this,t)}return ie(t,null,[{key:"getHeader",value:function(t,n){var r,i,o=null===(r=t.step)||void 0===r?void 0:r.title;if(!o)return K();n.showSteps&&(o="".concat(null===(i=t.step)||void 0===i?void 0:i.id,": ").concat(o));return e("h3",Object.assign({className:"usa-card__heading"},{children:o}),void 0)}},{key:"getSupportingDetails",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.subTitle;return r?e("p",{className:"font-sans-6",dangerouslySetInnerHTML:{__html:r}},void 0):K()}},{key:"getQuestionHelp",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.info;return r?e("p",Object.assign({className:"font-sans-6"},{children:r}),void 0):K()}},{key:"getFooter",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.footer;return r?e("p",{className:"font-sans-6",dangerouslySetInnerHTML:{__html:r}},void 0):K()}},{key:"resetQuestionable",value:function(e){e.dispatchForm({type:F.RESET}),e.wizard.goToStep("A")}}]),t}(),ce=function(t){var r=ne().config;return n("div",{children:[e("section",{children:e(f,{children:n(p,Object.assign({headerFirst:!0,gridLayout:{tablet:{col:12}},containerProps:{className:"border-ink"}},{children:[n(g,Object.assign({className:"bg-base-lightest"},{children:[se.getHeader(t,r),se.getSupportingDetails(t),se.getQuestionHelp(t)]}),void 0),e(b,Object.assign({className:"padding-top-3"},{children:t.children}),void 0),e(h,{children:se.getFooter(t)},void 0)]}),void 0)},void 0)},void 0),e(ae,Object.assign({},t),void 0)]},void 0)},ue=function(t){var n=t.step;return n?e(ce,Object.assign({},t,{children:e("p",{children:n.body},void 0)}),void 0):K()},le=function(t){return t.step?e(ce,Object.assign({},t),void 0):K()},de=function(){function t(){Q(this,t)}return ie(t,null,[{key:"getReason",value:function(e,t,n){var r,i=null===(r=t.match)||void 0===r?void 0:r.explanation,o=n.questionnaire,a=n.config;if(!i)return"";if(null!=a&&a.dev&&t.match){var s,c;if(i+="<br><br>",void 0!==t.match.ageCalc||void 0!==t.match.minAge||void 0!==t.match.maxAge)i+="You are ".concat(null===(s=e.form.age)||void 0===s?void 0:s.years," years "),i+="and ".concat(null===(c=e.form.age)||void 0===c?void 0:c.months," months old. ");Object.keys(t.match.answers).forEach((function(e){var t=o.getQuestionById(e);i+='You answered "<b>'.concat(t.answer,'</b>" to the question "<i>').concat(t.title,'.</i>" ')}))}return i}},{key:"getResults",value:function(r,i){return i.questionnaire.getResults(r.form).map((function(o){return n("li",Object.assign({className:"padding-bottom-2"},{children:[n("span",{children:[o.label,":","  ",e("b",{children:o.name},void 0)]},void 0),e("div",{className:"text-light",dangerouslySetInnerHTML:{__html:t.getReason(r,o,i)}},void 0)]}),"".concat(r.stepId,"_").concat(o.id))}))}}]),t}(),ve=function(e){return!(!e||e.length<8)&&!!I(e,"MM/DD/YYYY",!0).isValid()},fe=function(e){if(ve(e)){var t=new Date(+e.substring(6,10),+e.substring(0,2)-1,+e.substring(3,5));return N.fromJSDate(t)}},pe=function(e){if(e&&ve(e)){var t=fe(e);if(t)return function(e){var t=N.now(),n=t.year,r=t.month,i=t.day,o=e.year,a=e.month,s=e.day,c=n-o,u=0;r>=a?u=r-a:(c-=1,u=12+r-a);var l=0;return i>=s?l=i-s:(l=31+i-s,(u+=-1)<0&&(u=11,c-=1)),{days:l,months:u,years:c}}(t)}},ge=function(){function t(){Q(this,t)}return ie(t,null,[{key:"updateForm",value:function(e,t){Object.assign(t.step,{answer:e});var n={answers:R({},t.step.id,t.step)};return t.dispatchForm({type:F.UPDATE,value:n})}},{key:"getRadio",value:function(n,r){var i=function(){return t.updateForm(n,r)},o=oe.getDomId(n,r);return e(y,{id:o,name:oe.getFieldSetName(r),label:n,value:n,checked:!0===t.isSelected(n,r),className:"multipleChoice",onChange:i,onClick:i},o)}},{key:"isSelected",value:function(e,t){if(null!=t&&t.form){var n=t.form.answers[t.step.id];return oe.isValid(t.form,t.step.id)&&n.answer===e}}},{key:"getRadios",value:function(n){return e(O,Object.assign({legend:n.step.title,className:"multipleChoice",legendStyle:"srOnly"},{children:Object.keys(n.step.answers).map((function(e){return t.getRadio(n.step.answers[+e],n)}))}),void 0)}},{key:"getCheckbox",value:function(n,r){var i=function(){return t.updateForm(n,r)},o=oe.getDomId(n,r);return e(m,{id:o,name:oe.getFieldSetName(r),label:n,value:n,checked:!0===t.isSelected(n,r),className:"multipleSelect",onChange:i,onClick:i},o)}},{key:"getCheckboxes",value:function(n){return e(O,Object.assign({legend:n.step.title,className:"multipleChoice",legendStyle:"srOnly"},{children:Object.keys(n.step.answers).map((function(e){return t.getCheckbox(n.step.answers[+e],n)}))}),void 0)}},{key:"getBirthdate",value:function(e){var t;if(null!==(t=e.form)&&void 0!==t&&t.birthdate)return fe(e.form.birthdate)}},{key:"toBirthdate",value:function(e){if(e.month&&e.day&&e.year)return"".concat(e.month.padStart(2,"0"),"/").concat(e.day.padStart(2,"0"),"/").concat(e.year)}}]),t}(),be=function(t){var r=t.step,i=ne(),o=i.questionnaire;if(!r)return K();var a=o.getAction();return e(ce,Object.assign({},t,{children:n(j,Object.assign({heading:r.bodyHeader||"",style:{paddingTop:"20px"}},{children:[e("p",{children:r.bodySubHeader},void 0),e("ul",Object.assign({className:"usa-list usa-list--unstyled",style:{textAlign:"left"}},{children:de.getResults(t,i)}),void 0),e("p",{dangerouslySetInnerHTML:{__html:(null==r?void 0:r.body)||""}},void 0),e("h2",{children:a.title},void 0),e("p",{children:a.description},void 0),e("p",{dangerouslySetInnerHTML:{__html:a.action}},void 0),"."]}),void 0)}),void 0)},he=function(t){var r=Object.keys(t.form.answers).map((function(r){return e("li",Object.assign({className:"padding-bottom-2"},{children:n("span",Object.assign({className:"text-light"},{children:[t.form.answers[r].title,":  ",e("b",{children:t.form.answers[r].answer},void 0)]}),void 0)}),r)}));return e("ul",Object.assign({className:"usa-list usa-list--unstyled"},{children:r}),void 0)},ye=function(t){return t.step?e(ce,Object.assign({},t,{children:he(t)}),void 0):K()};function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var we=function(t){var r,o,a,s,c,u,l=t.step,v={day:null===(r=ge.getBirthdate(t))||void 0===r||null===(o=r.day)||void 0===o?void 0:o.toString(),month:null===(a=ge.getBirthdate(t))||void 0===a||null===(s=a.month)||void 0===s?void 0:s.toString(),year:null===(c=ge.getBirthdate(t))||void 0===c||null===(u=c.year)||void 0===u?void 0:u.toString()},f=k(i(v),2),p=f[0],g=f[1];if(!l)return K();var b,h=function(e,n){var r=e.target.value;if(r){p[n]=r,g(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},p));var i=ge.toBirthdate(p),o=pe(i);o&&t.dispatchForm({type:F.UPDATE,value:{age:o,birthdate:i}})}},y=function(n,r){var i=2;return n===B.YEAR&&(i=4),e(S,{id:oe.getDomId(n,t),name:r,label:d(n),unit:n,maxLength:i,minLength:i,defaultValue:p[n],onChange:function(e){return h(e,n)}},void 0)};return b="date_of_birth",n(w,{children:[y(B.MONTH,b),y(B.DAY,b),y(B.YEAR,b)]},void 0)},Se=function(t){return e(ce,Object.assign({},t,{children:e(we,Object.assign({},t),void 0)}),void 0)},Ee=function(e){var t;return void 0===(null==e||null===(t=e.step)||void 0===t?void 0:t.answers)?K("Question and answer are not defined"):ge.getRadios(e)},Pe=function(t){return e(ce,Object.assign({},t,{children:e(Ee,Object.assign({},t),void 0)}),void 0)},De=function(e){var t;return void 0===(null==e||null===(t=e.step)||void 0===t?void 0:t.answers)?K():ge.getCheckboxes(e)},Ne=function(t){return e(ce,Object.assign({},t,{children:e(De,Object.assign({},t),void 0)}),void 0)};function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke=function(t){var n=t.stepId,r=ne().questionnaire.getStepById("".concat(n));return q(C,r.type)?function(t){var n=t.stepId,r=ne().questionnaire,i=r.getStepById("".concat(n));if(!q(C,i.type))return K("Not a question");var o=r.getQuestionById(i.id),a=Te({},Te({step:o},t));switch(o.type){case C.DOB:return e(Se,Object.assign({},a),void 0);case C.MULTIPLE_CHOICE:return e(Pe,Object.assign({},a),void 0);case C.MULTIPLE_SELECT:return e(Ne,Object.assign({},a),void 0);default:return K("Question does not exist","QuestionFactory")}}(t):q(_,r.type)?function(t){var n=t.stepId,r=ne().questionnaire,i=r.getStepById("".concat(n));if(!q(_,i.type))return K("Not a page");var o=r.getPageById(i.id),a=me({},me({step:o},t));switch(o.type){case _.LANDING:return e(ue,Object.assign({},a),void 0);case _.NO_RESULTS:return e(le,Object.assign({},a),void 0);case _.RESULTS:return e(be,Object.assign({},a),void 0);case _.SUMMARY:return e(ye,Object.assign({},a),void 0);default:return K("Page does not exist","PageFactory")}}(t):K("Step does not exist","StepFactory")},Re=function(r){if(!ne().config.dev)return K();return n(t,{children:[e(E,{items:[{content:e("pre",{children:e("code",{children:JSON.stringify(r.form,null,4)},void 0)},void 0),expanded:!1,id:"developer-output",title:"Temporary developer panel"}]},void 0),e("br",{},void 0),e("nav",Object.assign({className:"wizard-layout__navbar"},{children:e(v,Object.assign({type:"reset",secondary:!0,onClick:function(){return se.resetQuestionable(r)}},{children:"Reset"}),void 0)}),void 0)]},void 0)},Le=function(t){return e(D,{label:t.name,status:t.status},t.id)},Ae=function(t){var n=ne().questionnaire;return 0===n.getSections(t).length?K():e(P,Object.assign({centered:!0,counters:"small"},{children:n.getSections(t).map(Le)}),void 0)},Ce=function(t){var r=t.questionnaire;if(!r)throw new Error("questionable is undefined");var i=k(s(r.flow),2),o=i[0],c=i[1],u=k(a(W,new z),2),l=u[0],d=u[1];return n(Z,Object.assign({value:t},{children:[e("section",{children:e(Ae,Object.assign({},{dispatchForm:d,form:l,stepId:o,wizard:c}),void 0)},void 0),e("section",Object.assign({className:"section"},{children:e(ke,Object.assign({},{dispatchForm:d,form:l,stepId:o,wizard:c}),void 0)}),void 0),e("section",Object.assign({className:"section"},{children:e(Re,Object.assign({},{dispatchForm:d,form:l,stepId:o,wizard:c}),void 0)}),void 0)]}),void 0)};export{Ce as Questionable};
//# sourceMappingURL=index.esm.js.map
