import{jsx as e,Fragment as t,jsxs as n}from"react/jsx-runtime";import{createContext as r,useState as i,useContext as o,useReducer as s}from"react";import{useWizard as a}from"use-wizard";import{merge as c,values as u,kebabCase as l,capitalize as d,isString as f}from"lodash";import{SiteAlert as p,Accordion as v,Button as g,StepIndicator as h,StepIndicatorStep as b,Radio as O,Fieldset as y,Checkbox as m,CardGroup as S,Card as j,CardHeader as w,CardBody as E,CardFooter as P,SummaryBox as T,DateInputGroup as R,DateInput as I}from"@trussworks/react-uswds";import{DateTime as N}from"luxon";import A from"file-saver";import D from"@ramonak/react-progress-bar";import L from"@rjsf/semantic-ui";import{ArrayUnique as k}from"class-validator";function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(e,t)||U(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M,x,Y,F=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,e),q(this,"started",void 0),q(this,"finished",void 0),q(this,"birthdate",void 0),q(this,"age",void 0),q(this,"responses",[]),Object.assign(this,t),this.started=new Date},G=r({setState:{},state:{}}),H=function(){var e=o(G);if(!e)throw new Error("useGlobalState must be used within a GlobalStateContext");return e},V=function(t){var n=t.children,r=t.value,o=C(i(void 0===r?{}:r),2),s=o[0],a=o[1];return e(G.Provider,Object.assign({value:{setState:a,state:s}},{children:n}),void 0)},W=function(){var e=H().state.questionnaire;if(!e)throw new Error("useQuestionnaire has no data");return e},Q=function(){var e=H().state.config;if(!e)throw new Error("useConfig has no data");return e},z=function(){return{config:Q(),questionnaire:W()}};function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.DOB="dob",e.MULTIPLE_CHOICE="multiple_choice",e.MULTIPLE_SELECT="multiple_select"}(M||(M={})),function(e){e.LANDING="Landing",e.NO_RESULTS="No Results",e.RESULTS="Results",e.SUMMARY="Summary"}(x||(x={})),function(e){e.EDIT="Edit"}(Y||(Y={}));var K,X,Z,ee,te,ne,re,ie=$($($({},x),M),Y);!function(e){e[e.FORWARD=1]="FORWARD",e[e.BACKWARD=-1]="BACKWARD"}(K||(K={})),function(e){e.COMPLETE="complete",e.CURRENT="current",e.INCOMPLETE="incomplete"}(X||(X={})),function(e){e.CALL="call",e.HYBRID="hybrid",e.ONLINE="online"}(Z||(Z={})),function(e){e.RESET="RESET",e.UPDATE="UPDATE"}(ee||(ee={})),function(e){e.DAY="day",e.MONTH="month",e.YEAR="year"}(te||(te={})),function(e){e.DEV="dev",e.EDIT="edit",e.VIEW="view"}(ne||(ne={})),function(e){e.BASE="usds-q",e.DEV_PANEL_SECTION="usds-q-dev-panel",e.DOB="usds-q-dob",e.MULTI_CHOICE="usds-q-multi-choice",e.MULTI_CHOICE_GROUP="usds-q-multi-choice-group",e.MULTI_SELECT="usds-q-multi-select",e.MULTI_SELECT_GROUP="usds-q-multi-select-group",e.NAVBAR="usds-q-navbar",e.NAVBAR_BUTTON="usds-q-navbar-button",e.PROGRESS_BAR="usds-q-progress-bar",e.PROGRESS_BAR_BOTTOM_SECTION="usds-q-progress-bar-bottom-section",e.PROGRESS_BAR_TOP_SECTION="usds-q-progress-bar-top-section",e.RESULTS_SUMMARY_BOX="usds-q-results-summary-box",e.RESULTS_SUMMARY_HEADER="usds-q-results-summary-header",e.STEP_FOOTER="usds-q-step-footer",e.STEP_HEADER="usds-q-step-header",e.STEP_INFO="usds-q-step-info",e.STEP_LAYOUT="usds-q-step-layout",e.STEP_LAYOUT_SECTION="usds-q-step-layout-section",e.STEP_SUBTITLE="usds-q-step-subtitle"}(re||(re={}));var oe=function(e,t){return Object.values(e).includes(t)};function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ce=function(e,t){switch(null==t?void 0:t.type){case ee.RESET:return new F;case ee.UPDATE:return c(ae({},e),ae({},t.value));default:return e}},ue=require("moment"),le=function(e){return!(!e||e.length<8)&&!!ue(e,"MM/DD/YYYY",!0).isValid()},de=function(e){if(le(e)){var t=new Date(+e.substring(6,10),+e.substring(0,2)-1,+e.substring(3,5));return N.fromJSDate(t)}},fe=function(e){if(e&&le(e)){var t=de(e);if(t)return function(e){var t=N.now(),n=t.year,r=t.month,i=t.day,o=e.year,s=e.month,a=e.day,c=n-o,u=0;r>=s?u=r-s:(c-=1,u=12+r-s);var l=0;return i>=a?l=i-a:(l=31+i-a,(u+=-1)<0&&(u=11,c-=1)),{days:l,months:u,years:c}}(t)}},pe={buttons:{next:{label:"Get Started"}},id:x.LANDING,section:{id:x.LANDING},title:x.LANDING,type:x.LANDING},ve={id:x.RESULTS,section:{id:x.RESULTS},title:x.RESULTS,type:x.RESULTS},ge={landingPage:pe,noResultsPage:{id:x.NO_RESULTS,section:{id:x.RESULTS},title:x.NO_RESULTS,type:x.NO_RESULTS},resultsPage:ve,summaryPage:{buttons:{next:{label:"Submit"}},id:x.SUMMARY,section:{id:x.RESULTS},title:x.SUMMARY,type:x.SUMMARY}};function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t,n){return t&&he(e.prototype,t),n&&he(e,n),e}var Oe=function(){function e(){B(this,e)}return be(e,null,[{key:"sanitize",value:function(e){return e.toLowerCase().trim()}},{key:"matches",value:function(t,n){return!(!t||!n)&&e.sanitize(t)===e.sanitize(n)}}]),e}();function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Se=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log(me({},t))},je=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(n||r)&&Se("Created an empty element",n,r),e(t,{children:n},void 0)},we=function(){function t(){B(this,t)}return be(t,null,[{key:"getHeader",value:function(t,n){var r,i,o=null===(r=t.step)||void 0===r?void 0:r.title;if(!o)return je();n.steps.showStepId&&(o="".concat(null===(i=t.step)||void 0===i?void 0:i.id,": ").concat(o));return e("h3",Object.assign({className:"usa-card__heading ".concat(re.STEP_HEADER)},{children:o}),void 0)}},{key:"getSubtitle",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.subTitle;return r?e("p",{className:re.STEP_SUBTITLE,dangerouslySetInnerHTML:{__html:r}},void 0):je()}},{key:"getInfoBox",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.info;return r?e(p,Object.assign({variant:"info",showIcon:!1,className:"outline-1px ".concat(re.STEP_INFO)},{children:r}),void 0):je()}},{key:"getFooter",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.footer;return r?e("p",{className:"font-sans-6 ".concat(re.STEP_FOOTER),dangerouslySetInnerHTML:{__html:r}},void 0):je()}},{key:"resetQuestionable",value:function(e){e.dispatchForm({type:ee.RESET}),e.wizard.goToStep("A")}},{key:"saveAsJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"questionable.json",n=new Blob([e],{type:"text/plain;charset=utf-8"});A.saveAs(n,t)}}]),t}(),Ee=function(r){if(!z().config.dev)return je();return n(t,{children:[e(v,{items:[{content:e("pre",{children:e("code",{children:JSON.stringify(r.form,null,4)},void 0)},void 0),expanded:!1,id:"developer-output",title:"Temporary developer panel"}]},void 0),e("br",{},void 0),e("nav",Object.assign({className:re.NAVBAR},{children:e(g,Object.assign({type:"reset",secondary:!0,onClick:function(){return we.resetQuestionable(r)}},{children:"Reset"}),void 0)}),void 0)]},void 0)},Pe=function(t){var n=z(),r=n.config,i=n.questionnaire;if(r.progressBar.hide)return je();var o=i.getProgressPercent(t,r);return e("div",Object.assign({className:re.PROGRESS_BAR},{children:e(D,{completed:o,bgColor:r.progressBar.bgColor,baseBgColor:r.progressBar.baseBgColor,isLabelVisible:!1,borderRadius:"0px"},void 0)}),void 0)},Te=function(t){return e(b,{label:t.name,status:t.status||"incomplete"},t.id)},Re=function(t){var n=z(),r=n.config,i=n.questionnaire;if(r.progressBar.hide)return je();var o=i.getSections(t,r);return 0===o.length?je():e(h,Object.assign({centered:!0,counters:"small"},{children:o.map(Te)}),void 0)},Ie=function(t){var n=t.props,r=t.position,i=z().config;if(i.progressBar.hide||i.progressBar.position!==r)return je();switch(i.progressBar.type){case"progress-bar":return e(Pe,Object.assign({},n),void 0);case"step-indicator":return e(Re,Object.assign({},n),void 0);default:return je("Could not find progress type",i.progressBar.type)}},Ne=require("./survey.json");function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Le={properties:{step:{$ref:"#/definitions/IStep",title:"Step"}}},ke=De(De({type:"object"},Le),Ne),_e=function(){function t(){B(this,t)}return be(t,null,[{key:"getReason",value:function(e,t,n){var r,i=null===(r=t.match)||void 0===r?void 0:r.explanation,o=n.questionnaire,s=n.config;if(!i)return"";if(null!=s&&s.dev&&t.match){var a,c;if(i+="<br><br>",void 0!==t.match.ageCalc||void 0!==t.match.minAge||void 0!==t.match.maxAge)i+="You are ".concat(null===(a=e.form.age)||void 0===a?void 0:a.years," years "),i+="and ".concat(null===(c=e.form.age)||void 0===c?void 0:c.months," months old. ");Object.keys(t.match.responses).forEach((function(e){var t=o.getQuestionById(e);i+='You answered "<b>'.concat(t.answer,'</b>" to the question "<i>').concat(t.title,'.</i>" ')}))}return i}},{key:"getResults",value:function(r,i){return i.questionnaire.getResults(r.form).map((function(o){return n("li",Object.assign({className:"padding-bottom-2"},{children:[n("span",{children:[o.label,":","  ",e("b",{children:o.name},void 0)]},void 0),e("div",{className:"text-light",dangerouslySetInnerHTML:{__html:t.getReason(r,o,i)}},void 0)]}),"".concat(r.stepId,"_").concat(o.id))}))}}]),t}(),Ue=function(){function e(){B(this,e)}return be(e,null,[{key:"goToStep",value:function(e,t){t.wizard.goToStep(e)}},{key:"goToNextStep",value:function(t,n,r){e.goToStep(n.getNextStep(t,r),t)}},{key:"goToPrevStep",value:function(t,n,r){e.goToStep(n.getPreviousStep(t,r),t)}},{key:"isNextEnabled",value:function(t){var n,r,i;if(null==t||!t.step)throw new Error("This survery is not defined");return t.stepId===ie.LANDING||(t.stepId===ie.SUMMARY||!!t.form&&((null===(n=t.step)||void 0===n?void 0:n.type)===M.DOB?void 0!==(null===(r=t.form)||void 0===r||null===(i=r.age)||void 0===i?void 0:i.years)&&t.form.age.years>=0:e.isValid(t.form,t.step.id)))}},{key:"isValid",value:function(e,t){var n,r=e.responses.find((function(e){return e.id===t}));if(!r)return!1;var i=u(r.answers);switch(r.type){case ie.DOB:return void 0!==(null==e||null===(n=e.age)||void 0===n?void 0:n.years)&&e.age.years>0;case ie.MULTIPLE_CHOICE:return void 0!==r.answer&&void 0!==(null==i?void 0:i.find((function(e){return e.title===r.answer})));default:return!0}}},{key:"getFieldSetName",value:function(e){return l(e.step.title)}},{key:"getDomId",value:function(t,n){var r=e.getFieldSetName(n);return"".concat(r,"-").concat(l(t))}}]),e}(),Ce=function(){function t(){B(this,t)}return be(t,null,[{key:"updateForm",value:function(e,t){Object.assign(t.step,{answer:e});var n={answers:[t.step]};return t.dispatchForm({type:ee.UPDATE,value:n})}},{key:"isSelected",value:function(e,t){if(null!=t&&t.form){var n=t.form.responses.find((function(e){return e.id===t.step.id}));if(n)return Ue.isValid(t.form,t.step.id)&&n.answer===e}}},{key:"getRadio",value:function(n,r,i){var o,s=function(){return t.updateForm(n.title,r)},a=Ue.getDomId(n.title,r);return e(O,{id:a,name:Ue.getFieldSetName(r),label:n.title,value:n.title,checked:!0===t.isSelected(n.title,r),className:re.MULTI_CHOICE,onChange:s,onClick:s,tile:!0===(null===(o=i.questions)||void 0===o?void 0:o.showAnswerBorder)},a)}},{key:"getRadios",value:function(n,r){return e(y,Object.assign({legend:n.step.title,className:re.MULTI_CHOICE_GROUP,legendStyle:"srOnly"},{children:n.step.answers.map((function(e){return t.getRadio(e,n,r)}))}),void 0)}},{key:"getCheckbox",value:function(n,r,i){var o,s=function(){return t.updateForm(n.title,r)},a=Ue.getDomId(n.title,r);return e(m,{id:a,name:Ue.getFieldSetName(r),label:n.title,value:n.title,checked:!0===t.isSelected(n.title,r),className:re.MULTI_SELECT,onChange:s,onClick:s,tile:!0===(null===(o=i.questions)||void 0===o?void 0:o.showAnswerBorder)},a)}},{key:"getCheckboxes",value:function(n,r){return e(y,Object.assign({legend:n.step.title,className:re.MULTI_SELECT_GROUP,legendStyle:"srOnly"},{children:n.step.answers.map((function(e){return t.getCheckbox(e,n,r)}))}),void 0)}},{key:"getBirthdate",value:function(e){var t;if(null!==(t=e.form)&&void 0!==t&&t.birthdate)return de(e.form.birthdate)}},{key:"toBirthdate",value:function(e){if(e.month&&e.day&&e.year)return"".concat(e.month.padStart(2,"0"),"/").concat(e.day.padStart(2,"0"),"/").concat(e.year)}}]),t}(),Be=function(t){return e(g,Object.assign({className:"".concat(re.NAVBAR_BUTTON," ").concat(re.NAVBAR_BUTTON,"-").concat(t.dir),"data-testid":"".concat(t.dir,"-button-").concat(t.stepId),disabled:t.disabled(),onClick:t.onClick,type:"button",unstyled:"link"===t.mode,outline:"link"!==t.mode&&"prev"===t.dir},{children:t.label}),void 0)},qe=function(t){var n,r,i=z(),o=i.questionnaire,s=i.config,a=t.step,c=t.verticalPos!==s.nav.prev.verticalPos,u=t.stepId===ie.LANDING||t.stepId===o.flow[1],l=t.stepId===ie.RESULTS||t.stepId===ie.NO_RESULTS,d=s.mode!==ne.EDIT||t.stepId===o.flow[0]&&s.mode===ne.EDIT;if(c||(u||l)&&d)return je();var f=(null==a||null===(n=a.buttons)||void 0===n||null===(r=n.prev)||void 0===r?void 0:r.label)||s.nav.prev.defaultLabel||"Previous";return e(Be,Object.assign({},{dir:"prev",disabled:function(){return!1},label:f,mode:s.nav.prev.mode||"link",onClick:function(){return Ue.goToPrevStep(t,o,s)},stepId:"".concat(t.stepId)}),void 0)},Me=function(t){var n,r,i=z(),o=i.questionnaire,s=i.config,a=t.step,c=t.verticalPos!==s.nav.next.verticalPos,u=t.stepId===ie.RESULTS||t.stepId===ie.NO_RESULTS,l=s.mode!==ne.EDIT||t.stepId===o.flow[o.flow.length-1]&&s.mode===ne.EDIT;if(c||u&&l)return je();var d=(null==a||null===(n=a.buttons)||void 0===n||null===(r=n.next)||void 0===r?void 0:r.label)||s.nav.next.defaultLabel||"Previous";return e(Be,Object.assign({},{dir:"next",disabled:function(){return s.mode===ne.VIEW&&!Ue.isNextEnabled(t)},label:d,mode:s.nav.next.mode||"button",onClick:function(){return Ue.goToNextStep(t,o,s)},stepId:"".concat(t.stepId)}),void 0)},xe=function(t){return n("nav",Object.assign({className:"".concat(re.NAVBAR," ").concat(re.NAVBAR,"-").concat(t.verticalPos)},{children:[e(qe,Object.assign({},t),void 0),e(Me,Object.assign({},t),void 0)]}),void 0)};function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ge=function(t){var r=z().questionnaire;return n("div",{children:[e(xe,Object.assign({},Fe(Fe({},t),{},{verticalPos:"top"})),void 0),e("section",{children:e(S,{children:n(j,Object.assign({headerFirst:!0,gridLayout:{tablet:{col:12}},containerProps:{className:"border-ink"}},{children:[e(w,Object.assign({className:"bg-base-lightest"},{children:n("h1",{children:["Edit the ",r.header]},void 0)}),void 0),e(E,Object.assign({className:"padding-top-3"},{children:t.children}),void 0),e(P,{children:'Click "Save" to save your edits, or "Next" to continue editing'},void 0)]}),void 0)},void 0)},void 0)]},void 0)},He=function(t){var n=z().questionnaire,r=function(e){var t=De({},Le);return oe(x,e.step.type)?t.properties.step.$ref="#/definitions/IPage":oe(M,e.step.type)&&(t.properties.step.$ref="#/definitions/IQuestion"),c(t,ke)}(t),i=l(n.header);return e(L,Object.assign({schema:r,uiSchema:{step:{"ui:order":["title","subTitle","bodyHeader","bodySubHeader","body","info","footer","*"]}},onSubmit:function(e){var t=e.formData;we.saveAsJson(t,"".concat(i,".json"))},formData:{step:t.step}},{children:e("div",{children:e(g,Object.assign({type:"submit"},{children:"Save"}),void 0)},void 0)}),void 0)},Ve=function(t){return e(Ge,Object.assign({},t,{children:e(He,Object.assign({},t),void 0)}),void 0)};function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=function(t){var r=z().config,i=r.steps,o=i.borderClass,s=i.titleClass;return n("div",{children:[e(xe,Object.assign({},Je(Je({},t),{},{verticalPos:"top"})),void 0),e("section",Object.assign({className:re.STEP_LAYOUT},{children:e(S,{children:n(j,Object.assign({headerFirst:!0,gridLayout:{tablet:{col:12}},containerProps:{className:o}},{children:[e(w,Object.assign({className:s},{children:we.getHeader(t,r)}),void 0),n(E,{children:[we.getSubtitle(t),t.children,we.getInfoBox(t)]},void 0),e(P,{children:we.getFooter(t)},void 0)]}),void 0)},void 0)}),void 0),e(xe,Object.assign({},Je(Je({},t),{},{verticalPos:"bottom"})),void 0)]},void 0)},Ke=function(t){var n=t.step;return n?e($e,Object.assign({},t,{children:e("p",{children:n.body},void 0)}),void 0):je()},Xe=function(t){return t.step?e($e,Object.assign({},t),void 0):je()},Ze=function(t){var r=t.step,i=z(),o=i.questionnaire;if(!r)return je();var s=o.getAction();return e($e,Object.assign({},t,{children:n(T,Object.assign({heading:r.bodyHeader||"",className:re.RESULTS_SUMMARY_HEADER},{children:[e("p",{children:r.bodySubHeader},void 0),e("ul",Object.assign({className:"usa-list usa-list--unstyled ".concat(re.RESULTS_SUMMARY_BOX)},{children:_e.getResults(t,i)}),void 0),e("p",{dangerouslySetInnerHTML:{__html:(null==r?void 0:r.body)||""}},void 0),e("h2",{children:s.title},void 0),e("p",{children:s.description},void 0),e("p",{dangerouslySetInnerHTML:{__html:s.action}},void 0),"."]}),void 0)}),void 0)},et=function(t){var r=t.form.responses.map((function(t){return e("li",Object.assign({className:"padding-bottom-2"},{children:n("span",Object.assign({className:"text-light"},{children:[t.title,":  ",e("b",{children:t.answer},void 0)]}),void 0)}),t.id)}));return e("ul",Object.assign({className:"usa-list usa-list--unstyled"},{children:r}),void 0)},tt=function(t){return t.step?e($e,Object.assign({},t,{children:et(t)}),void 0):je()};function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ot=function(t){var r,o,s,a,c,u,l=t.step,f={day:null===(r=Ce.getBirthdate(t))||void 0===r||null===(o=r.day)||void 0===o?void 0:o.toString(),month:null===(s=Ce.getBirthdate(t))||void 0===s||null===(a=s.month)||void 0===a?void 0:a.toString(),year:null===(c=Ce.getBirthdate(t))||void 0===c||null===(u=c.year)||void 0===u?void 0:u.toString()},p=C(i(f),2),v=p[0],g=p[1];if(!l)return je();var h,b=function(e,n){var r=e.target.value;if(r){v[n]=r,g(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},v));var i=Ce.toBirthdate(v),o=fe(i);o&&t.dispatchForm({type:ee.UPDATE,value:{age:o,birthdate:i}})}},O=function(n,r){var i=2;return n===te.YEAR&&(i=4),e(I,{id:Ue.getDomId(n,t),name:r,label:d(n),unit:n,maxLength:i,minLength:i,defaultValue:v[n],onChange:function(e){return b(e,n)}},void 0)};return h="date_of_birth",n(R,{children:[O(te.MONTH,h),O(te.DAY,h),O(te.YEAR,h)]},void 0)},st=function(t){return e($e,Object.assign({},t,{children:e(ot,Object.assign({},t),void 0)}),void 0)},at=function(e){var t,n=z().config;return void 0===(null==e||null===(t=e.step)||void 0===t?void 0:t.answers)?je():Ce.getCheckboxes(e,n)},ct=function(t){return e($e,Object.assign({},t,{children:e(at,Object.assign({},t),void 0)}),void 0)},ut=function(e){var t,n=z().config;return void 0===(null==e||null===(t=e.step)||void 0===t?void 0:t.answers)?je("Question and answer are not defined"):Ce.getRadios(e,n)},lt=function(t){return e($e,Object.assign({},t,{children:e(ut,Object.assign({},t),void 0)}),void 0)};function dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dt(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pt=function(t,n){return oe(M,n.type)?function(t){var n=t.stepId,r=z().questionnaire,i=r.getStepById("".concat(n));if(!oe(M,i.type))return je("Not a question");var o=r.getQuestionById(i.id),s=ft({},ft({step:o},t));switch(o.type){case M.DOB:return e(st,Object.assign({},s),void 0);case M.MULTIPLE_CHOICE:return e(lt,Object.assign({},s),void 0);case M.MULTIPLE_SELECT:return e(ct,Object.assign({},s),void 0);default:return je("Question does not exist","QuestionFactory")}}(t):oe(x,n.type)?function(t){var n=t.stepId,r=z().questionnaire,i=r.getStepById("".concat(n));if(!oe(x,i.type))return je("Not a page");var o=r.getPageById(i.id),s=rt({},rt({step:o},t));switch(o.type){case x.LANDING:return e(Ke,Object.assign({},s),void 0);case x.NO_RESULTS:return e(Xe,Object.assign({},s),void 0);case x.RESULTS:return e(Ze,Object.assign({},s),void 0);case x.SUMMARY:return e(tt,Object.assign({},s),void 0);default:return je("Page does not exist","PageFactory")}}(t):je("Step does not exist","StepFactory")},vt=function(t){var n=t.stepId,r=z(),i=r.questionnaire,o=r.config,s=i.getStepById("".concat(n));return o.mode===ne.EDIT?function(t,n){var r=Qe({},Qe({step:z().questionnaire.getStepById(n.id)},t));if(oe(M,n.type)){var i=r;return e(Ve,Object.assign({},i),void 0)}if(oe(x,n.type)){var o=r;return e(Ve,Object.assign({},o),void 0)}return je("Not an editable type")}(t,s):pt(t,s)},gt=function(t){var r=t.questionnaire;if(!r)throw new Error("questionable is undefined");var i=C(a(r.flow),2),o=i[0],c=i[1],u=C(s(ce,new F),2),l=u[0],d=u[1];return e(V,Object.assign({value:t},{children:n("div",Object.assign({className:re.BASE},{children:[e("section",Object.assign({className:"section ".concat(re.PROGRESS_BAR_TOP_SECTION)},{children:e(Ie,Object.assign({},{position:"top",props:{dispatchForm:d,form:l,stepId:o,wizard:c}}),void 0)}),void 0),e("section",Object.assign({className:"section ".concat(re.STEP_LAYOUT_SECTION)},{children:e(vt,Object.assign({},{dispatchForm:d,form:l,stepId:o,wizard:c}),void 0)}),void 0),e("section",Object.assign({className:"section ".concat(re.PROGRESS_BAR_BOTTOM_SECTION)},{children:e(Ie,Object.assign({},{position:"bottom",props:{dispatchForm:d,form:l,stepId:o,wizard:c}}),void 0)}),void 0),e("section",Object.assign({className:"section ".concat(re.DEV_PANEL_SECTION)},{children:e(Ee,Object.assign({},{dispatchForm:d,form:l,stepId:o,wizard:c}),void 0)}),void 0)]}),void 0)}),void 0)};function ht(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function bt(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ht(e,t,"set"),n),n}function Ot(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ht(e,t,"get"))}function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var St=new WeakMap,jt=new WeakMap,wt=new WeakMap,Et=new WeakMap,Pt=new WeakMap,Tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,e),St.set(this,{writable:!0,value:ne.VIEW}),jt.set(this,{writable:!0,value:{next:{defaultLabel:"Next",horizontalPos:"left",mode:"button",verticalPos:"bottom"},prev:{defaultLabel:"Go back",horizontalPos:"left",mode:"link",verticalPos:"top"}}}),wt.set(this,{writable:!0,value:{baseBgColor:"#f0f0f0",bgColor:"#005ea2",hide:!1,position:"bottom",type:"progress-bar"}}),Et.set(this,{writable:!0,value:{showAnswerBorder:!0}}),Pt.set(this,{writable:!0,value:{borderClass:"border-0",showStepId:!1,titleClass:""}}),c(this,t),this.dev&&(Ot(this,Pt).showStepId=!0)}return be(e,[{key:"dev",get:function(){return Ot(this,St)===ne.DEV}},{key:"mode",get:function(){return Ot(this,St)},set:function(e){f(e)?oe(ne,e)?bt(this,St,e):bt(this,St,ne.VIEW):bt(this,St,e)}},{key:"nav",get:function(){return mt({},Ot(this,jt))},set:function(e){c(Ot(this,jt),e)}},{key:"progressBar",get:function(){return mt({},Ot(this,wt))},set:function(e){c(Ot(this,wt),e)}},{key:"questions",get:function(){return mt({},Ot(this,Et))},set:function(e){c(Ot(this,Et),e)}},{key:"steps",get:function(){return mt({},Ot(this,Pt))},set:function(e){c(Ot(this,Pt),e)}}]),e}();function Rt(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||U(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(e){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nt(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":It(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Dt=function(){function e(t){B(this,e),q(this,"questions",void 0),q(this,"header",void 0),q(this,"results",void 0),q(this,"flow",void 0),q(this,"sections",void 0),q(this,"actions",void 0),q(this,"pages",ge),q(this,"steps",void 0),Object.assign(this,t),this.steps=Rt(this.questions),this.init(),this.flow=this.steps.map((function(e){return e.id}))}return be(e,[{key:"getStepById",value:function(e){var t=this.steps.find((function(t){return t.id===e}));if(!t)throw new Error("Step id: ".concat(e," not found in survery"));return t}},{key:"getPageById",value:function(e){var t=this.getStepById(e);if(!oe(x,t.type))throw new Error("Step id: ".concat(e," is not a page"));return t}},{key:"getQuestion",value:function(e){if(!e.id)throw new Error("Question ".concat(e," is not defined"));return this.getQuestionById(e.id)}},{key:"getQuestionById",value:function(e){var t=this.getStepById(e);if(!oe(M,t.type))throw new Error("Step id: ".concat(e," not a question"));return t}},{key:"getStep",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Tt,o=-1!==this.flow.indexOf(e)?this.flow[this.flow.indexOf(e)+n]:void 0;if(!o)return e;if(i.mode===ne.EDIT)return o;if(o===ie.RESULTS&&0===this.getResults(t).length)return ie.NO_RESULTS;if(o===ie.NO_RESULTS&&this.getResults(t).length>0)return ie.RESULTS;var s,a=this.getStepById(o);if(null==a||!a.requirements)return o;if(a.requirements.forEach((function(e){var n=r.meetsAllRequirements(e,t);s=void 0===s?n:s||n})),s)return o;var c=this.getStep(o,t,n);return c!==o?c:e}},{key:"getNextStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt,n=e.stepId;return this.getStep(n,e.form,K.FORWARD,t)}},{key:"getPreviousStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt,n=e.stepId;return this.getStep(n,e.form,K.BACKWARD,t)}},{key:"getProgressPercent",value:function(e,t){var n,r;if(Oe.matches(null===(n=e.step)||void 0===n||null===(r=n.section)||void 0===r?void 0:r.id,x.RESULTS))return 100;var i=this.getSections(e,t),o=i[i.length-1];if(null==o||!o.lastStep)return.5;var s=this.flow.indexOf("".concat(e.stepId)),a=o.lastStep+2;return t.mode===ne.EDIT&&(a=this.flow.length-1),Math.round(s/a*100)}},{key:"getSections",value:function(e,t){var n=this;if(!e)return[];var r=e.stepId,i=this.getStepById(r),o=this.steps.indexOf(i),s=this.sections.filter((function(t){return 0===t.requirements.length||t.requirements.some((function(t){return n.meetsAllRequirements(t,e.form)}))}));return t.mode===ne.EDIT&&(s=Rt(this.sections)),s.map((function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return t.lastStep=n.questions.reduce((function(t,n,r){return n.section.id===e.id?r:t}),-1),Oe.matches(t.id,x.RESULTS)?t.lastStep=n.questions.length-2:Oe.matches(t.id,x.LANDING)&&(t.lastStep=0),t.lastStep<0?t.status=X.INCOMPLETE:Oe.matches(t.id,i.section.id)?t.status=X.CURRENT:t.lastStep<o&&(t.status=X.COMPLETE),t}))}},{key:"getResults",value:function(e){var t=this;return this.results.filter((function(n){return n.requirements.some((function(r){return!!t.meetsAllRequirements(r,e)&&(Object.assign(n,{match:r}),!0)}))}))}},{key:"getAction",value:function(){var e=Math.floor(Math.random()*this.actions.length);return this.actions[e]}},{key:"init",value:function(){var e,t,n;if((null===(e=this.questions)||void 0===e?void 0:e.length)<=0)throw new Error("No questions have been defined.");if((null===(t=this.header)||void 0===t?void 0:t.length)<=0)throw new Error("No header has been defined.");if((null===(n=this.results)||void 0===n?void 0:n.length)<=0)throw new Error("No results have been defined.");var r="step is not correctly defined or defined more than once";if(this.steps[0].type!==x.LANDING&&this.steps.unshift(this.pages.landingPage),1!==this.steps.filter((function(e){return e.type===x.LANDING})).length)throw new Error("".concat(x.LANDING," ").concat(r,"."));if(this.steps[this.steps.length-1].type!==x.NO_RESULTS&&this.steps.push(this.pages.noResultsPage),1!==this.steps.filter((function(e){return e.type===x.NO_RESULTS})).length)throw new Error("".concat(x.NO_RESULTS," ").concat(r,"."));if(this.steps[this.steps.length-2].type!==x.RESULTS&&this.steps.splice(this.steps.length-1,0,this.pages.resultsPage),1!==this.steps.filter((function(e){return e.type===x.RESULTS})).length)throw new Error("".concat(x.RESULTS," ").concat(r,"."));if(this.steps[this.steps.length-3].type!==x.SUMMARY&&this.steps.splice(this.steps.length-2,0,this.pages.summaryPage),1!==this.steps.filter((function(e){return e.type===x.SUMMARY})).length)throw new Error("".concat(x.SUMMARY," ").concat(r,"."))}},{key:"meetsAllRequirements",value:function(t,n){var r=t.minAge,i=t.maxAge,o=t.responses,s=t.ageCalc;return e.meetsMinAgeRequirements(n,r)&&e.meetsMaxAgeRequirements(n,i)&&e.meetsAgeCalcRequirements(n,s)&&this.meetsAnswerRequirements(o)}},{key:"meetsAnswerRequirements",value:function(e){var t=this;return!e||e.length<=0||e.every((function(e){var n,r=t.getQuestion(e.question);return!((null===(n=r.answers)||void 0===n?void 0:n.length)>0)||e.answers.some((function(e){var t;return void 0!==r.answer&&r.answer===(null===(t=r.answers.find((function(t){return t.id===e.id})))||void 0===t?void 0:t.title)}))}))}}],[{key:"meetsMinAgeRequirements",value:function(e,t){if(!t)return!0;if(void 0===e.age)return!1;var n=e.age,r=n.years,i=n.months;return r>(null==t?void 0:t.years)||r>=(null==t?void 0:t.years)&&i>=(null==t?void 0:t.months)}},{key:"meetsMaxAgeRequirements",value:function(e,t){if(!t)return!0;if(void 0===e.age)return!1;var n=e.age,r=n.years,i=n.months;return r<(null==t?void 0:t.years)||r<=(null==t?void 0:t.years)&&i<=(null==t?void 0:t.months)}},{key:"meetsAgeCalcRequirements",value:function(e,t){return!t||void 0!==e.birthdate&&t(e.birthdate)}}]),e}();Nt([k((function(e){return e.id}))],Dt.prototype,"questions",void 0),Nt([k((function(e){return e.label}))],Dt.prototype,"results",void 0),Nt([k((function(e){return e.id}))],Dt.prototype,"sections",void 0);export{gt as Questionable,Tt as QuestionableConfig,Dt as Questionnaire,Ne as surveySchema};
//# sourceMappingURL=index.esm.js.map
