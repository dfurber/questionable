"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react"),n=require("use-wizard"),r=require("lodash"),i=require("@trussworks/react-uswds"),o=require("luxon");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,c,u=s(require("moment"));function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.DOB="dob",e.MULTIPLE_CHOICE="multiple_choice",e.MULTIPLE_SELECT="multiple_select"}(a||(a={})),function(e){e.LANDING="Landing",e.NO_RESULTS="No Results",e.RESULTS="Results",e.SUMMARY="Summary"}(c||(c={}));var g,b,j,y,h,O,m=p(p({},c),a);!function(e){e[e.FORWARD=1]="FORWARD",e[e.BACKWARD=-1]="BACKWARD"}(g||(g={})),function(e){e.COMPLETE="complete",e.CURRENT="current"}(b||(b={})),function(e){e.CALL="call",e.HYBRID="hybrid",e.ONLINE="online"}(j||(j={})),function(e){e.RESET="RESET",e.UPDATE="UPDATE"}(y||(y={})),function(e){e.DAY="day",e.MONTH="month",e.YEAR="year"}(h||(h={})),function(e){e.EDIT="edit",e.VIEW="view"}(O||(O={}));var x=function(e,t){return Object.values(e).includes(t)};function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var S=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w(this,e),v(this,"started",void 0),v(this,"finished",void 0),v(this,"birthdate",void 0),v(this,"age",void 0),v(this,"answers",{}),Object.assign(this,t),this.started=new Date};function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var D=function(e,t){switch(null==t?void 0:t.type){case y.RESET:return new S;case y.UPDATE:return r.merge(E({},e),E({},t.value));default:return e}},I=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return console.log([].concat(t))},N=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return I("Created an empty element",t,n),e.jsx(e.Fragment,{children:t},void 0)},T=t.createContext({setState:{},state:{}}),k=function(){var e=t.useContext(T);if(!e)throw new Error("useGlobalState must be used within a GlobalStateContext");return e},C=function(n){var r=n.children,i=n.value,o=void 0===i?{}:i,s=d(t.useState(o),2),a=s[0],c=s[1];return e.jsx(T.Provider,Object.assign({value:{setState:c,state:a}},{children:r}),void 0)},R=function(){var e=k().state.questionnaire;if(!e)throw new Error("useQuestionnaire has no data");return e},A=function(){var e=k().state.config;if(!e)throw new Error("useConfig has no data");return e},L=function(){return{config:A(),questionnaire:R()}};function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),e}var B=function(){function e(){w(this,e)}return F(e,null,[{key:"goToStep",value:function(e,t){t.wizard.goToStep(e)}},{key:"goToNextStep",value:function(t,n){e.goToStep(n.getNextStep(t),t)}},{key:"goToPrevStep",value:function(t,n){e.goToStep(n.getPreviousStep(t),t)}},{key:"isNextEnabled",value:function(t){var n,r,i;if(null==t||!t.step)throw new Error("This survery is not defined");return t.stepId===m.LANDING||(t.stepId===m.SUMMARY||!!t.form&&((null===(n=t.step)||void 0===n?void 0:n.type)===a.DOB?void 0!==(null===(r=t.form)||void 0===r||null===(i=r.age)||void 0===i?void 0:i.years)&&t.form.age.years>=0:e.isValid(t.form,t.step.id)))}},{key:"isValid",value:function(e,t){var n;if(!e.answers[t])return!1;var i=e.answers[t],o=r.values(i.answers);switch(i.type){case m.DOB:return void 0!==(null==e||null===(n=e.age)||void 0===n?void 0:n.years)&&e.age.years>0;case m.MULTIPLE_CHOICE:return void 0!==i.answer&&-1!==(null==o?void 0:o.indexOf(i.answer));default:return!0}}},{key:"getFieldSetName",value:function(e){return r.kebabCase(e.step.title)}},{key:"getDomId",value:function(t,n){var i=e.getFieldSetName(n);return"".concat(i,"-").concat(r.kebabCase(t))}}]),e}(),M=function(t){var n,r,o,s,a=L().questionnaire,c=t.step,u=t.stepId!==m.LANDING&&t.stepId!==m.RESULTS&&t.stepId!==m.NO_RESULTS&&t.stepId!==a.flow[1],l=t.stepId!==m.RESULTS&&t.stepId!==m.NO_RESULTS,d=(null==c||null===(n=c.buttons)||void 0===n||null===(r=n.prev)||void 0===r?void 0:r.label)||"Previous",v=(null==c||null===(o=c.buttons)||void 0===o||null===(s=o.next)||void 0===s?void 0:s.label)||"Next";return e.jsxs("nav",Object.assign({className:"wizard-layout__navbar"},{children:[u&&e.jsx(i.Button,Object.assign({type:"button",outline:!0,onClick:function(){return B.goToPrevStep(t,a)},"data-testid":"prev-button-".concat(t.stepId)},{children:d}),void 0),!u&&e.jsx("div",{},void 0),l&&e.jsx(i.Button,Object.assign({type:"button",onClick:function(){return B.goToNextStep(t,a)},disabled:!B.isNextEnabled(t),"data-testid":"next-button-".concat(t.stepId)},{children:v}),void 0),!l&&e.jsx("div",{},void 0)]}),void 0)},U=function(){function t(){w(this,t)}return F(t,null,[{key:"getHeader",value:function(t,n){var r,i,o=null===(r=t.step)||void 0===r?void 0:r.title;if(!o)return N();n.showSteps&&(o="".concat(null===(i=t.step)||void 0===i?void 0:i.id,": ").concat(o));return e.jsx("h3",Object.assign({className:"usa-card__heading"},{children:o}),void 0)}},{key:"getSupportingDetails",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.subTitle;return r?e.jsx("p",{className:"font-sans-6",dangerouslySetInnerHTML:{__html:r}},void 0):N()}},{key:"getQuestionHelp",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.info;return r?e.jsx("p",Object.assign({className:"font-sans-6"},{children:r}),void 0):N()}},{key:"getFooter",value:function(t){var n,r=null===(n=t.step)||void 0===n?void 0:n.footer;return r?e.jsx("p",{className:"font-sans-6",dangerouslySetInnerHTML:{__html:r}},void 0):N()}},{key:"resetQuestionable",value:function(e){e.dispatchForm({type:y.RESET}),e.wizard.goToStep("A")}}]),t}(),q=function(t){var n=L().config;return e.jsxs("div",{children:[e.jsx("section",{children:e.jsx(i.CardGroup,{children:e.jsxs(i.Card,Object.assign({headerFirst:!0,gridLayout:{tablet:{col:12}},containerProps:{className:"border-ink"}},{children:[e.jsxs(i.CardHeader,Object.assign({className:"bg-base-lightest"},{children:[U.getHeader(t,n),U.getSupportingDetails(t),U.getQuestionHelp(t)]}),void 0),e.jsx(i.CardBody,Object.assign({className:"padding-top-3"},{children:t.children}),void 0),e.jsx(i.CardFooter,{children:U.getFooter(t)},void 0)]}),void 0)},void 0)},void 0),e.jsx(M,Object.assign({},t),void 0)]},void 0)},H=function(t){var n=t.step;return n?e.jsx(q,Object.assign({},t,{children:e.jsx("p",{children:n.body},void 0)}),void 0):N()},Y=function(t){return t.step?e.jsx(q,Object.assign({},t),void 0):N()},Q=function(){function t(){w(this,t)}return F(t,null,[{key:"getReason",value:function(e,t,n){var r,i=null===(r=t.match)||void 0===r?void 0:r.explanation,o=n.questionnaire,s=n.config;if(!i)return"";if(null!=s&&s.dev&&t.match){var a,c;if(i+="<br><br>",void 0!==t.match.ageCalc||void 0!==t.match.minAge||void 0!==t.match.maxAge)i+="You are ".concat(null===(a=e.form.age)||void 0===a?void 0:a.years," years "),i+="and ".concat(null===(c=e.form.age)||void 0===c?void 0:c.months," months old. ");Object.keys(t.match.answers).forEach((function(e){var t=o.getQuestionById(e);i+='You answered "<b>'.concat(t.answer,'</b>" to the question "<i>').concat(t.title,'.</i>" ')}))}return i}},{key:"getResults",value:function(n,r){return r.questionnaire.getResults(n.form).map((function(i){return e.jsxs("li",Object.assign({className:"padding-bottom-2"},{children:[e.jsxs("span",{children:[i.label,":","  ",e.jsx("b",{children:i.name},void 0)]},void 0),e.jsx("div",{className:"text-light",dangerouslySetInnerHTML:{__html:t.getReason(n,i,r)}},void 0)]}),"".concat(n.stepId,"_").concat(i.id))}))}}]),t}(),z=function(e){return!(!e||e.length<8)&&!!u.default(e,"MM/DD/YYYY",!0).isValid()},G=function(e){if(z(e)){var t=new Date(+e.substring(6,10),+e.substring(0,2)-1,+e.substring(3,5));return o.DateTime.fromJSDate(t)}},V=function(e){if(e&&z(e)){var t=G(e);if(t)return function(e){var t=o.DateTime.now(),n=t.year,r=t.month,i=t.day,s=e.year,a=e.month,c=e.day,u=n-s,l=0;r>=a?l=r-a:(u-=1,l=12+r-a);var d=0;return i>=c?d=i-c:(d=31+i-c,(l+=-1)<0&&(l=11,u-=1)),{days:d,months:l,years:u}}(t)}},W=function(){function t(){w(this,t)}return F(t,null,[{key:"updateForm",value:function(e,t){Object.assign(t.step,{answer:e});var n={answers:v({},t.step.id,t.step)};return t.dispatchForm({type:y.UPDATE,value:n})}},{key:"getRadio",value:function(n,r){var o=function(){return t.updateForm(n,r)},s=B.getDomId(n,r);return e.jsx(i.Radio,{id:s,name:B.getFieldSetName(r),label:n,value:n,checked:!0===t.isSelected(n,r),className:"multipleChoice",onChange:o,onClick:o},s)}},{key:"isSelected",value:function(e,t){if(null!=t&&t.form){var n=t.form.answers[t.step.id];return B.isValid(t.form,t.step.id)&&n.answer===e}}},{key:"getRadios",value:function(n){return e.jsx(i.Fieldset,Object.assign({legend:n.step.title,className:"multipleChoice",legendStyle:"srOnly"},{children:Object.keys(n.step.answers).map((function(e){return t.getRadio(n.step.answers[+e],n)}))}),void 0)}},{key:"getCheckbox",value:function(n,r){var o=function(){return t.updateForm(n,r)},s=B.getDomId(n,r);return e.jsx(i.Checkbox,{id:s,name:B.getFieldSetName(r),label:n,value:n,checked:!0===t.isSelected(n,r),className:"multipleSelect",onChange:o,onClick:o},s)}},{key:"getCheckboxes",value:function(n){return e.jsx(i.Fieldset,Object.assign({legend:n.step.title,className:"multipleChoice",legendStyle:"srOnly"},{children:Object.keys(n.step.answers).map((function(e){return t.getCheckbox(n.step.answers[+e],n)}))}),void 0)}},{key:"getBirthdate",value:function(e){var t;if(null!==(t=e.form)&&void 0!==t&&t.birthdate)return G(e.form.birthdate)}},{key:"toBirthdate",value:function(e){if(e.month&&e.day&&e.year)return"".concat(e.month.padStart(2,"0"),"/").concat(e.day.padStart(2,"0"),"/").concat(e.year)}}]),t}(),J=function(t){var n=t.step,r=L(),o=r.questionnaire;if(!n)return N();var s=o.getAction();return e.jsx(q,Object.assign({},t,{children:e.jsxs(i.SummaryBox,Object.assign({heading:n.bodyHeader||"",style:{paddingTop:"20px"}},{children:[e.jsx("p",{children:n.bodySubHeader},void 0),e.jsx("ul",Object.assign({className:"usa-list usa-list--unstyled",style:{textAlign:"left"}},{children:Q.getResults(t,r)}),void 0),e.jsx("p",{dangerouslySetInnerHTML:{__html:(null==n?void 0:n.body)||""}},void 0),e.jsx("h2",{children:s.title},void 0),e.jsx("p",{children:s.description},void 0),e.jsx("p",{dangerouslySetInnerHTML:{__html:s.action}},void 0),"."]}),void 0)}),void 0)},K=function(t){var n=Object.keys(t.form.answers).map((function(n){return e.jsx("li",Object.assign({className:"padding-bottom-2"},{children:e.jsxs("span",Object.assign({className:"text-light"},{children:[t.form.answers[n].title,":  ",e.jsx("b",{children:t.form.answers[n].answer},void 0)]}),void 0)}),n)}));return e.jsx("ul",Object.assign({className:"usa-list usa-list--unstyled"},{children:n}),void 0)},$=function(t){return t.step?e.jsx(q,Object.assign({},t,{children:K(t)}),void 0):N()};function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var te=function(n){var o,s,a,c,u,l,f=n.step,p={day:null===(o=W.getBirthdate(n))||void 0===o||null===(s=o.day)||void 0===s?void 0:s.toString(),month:null===(a=W.getBirthdate(n))||void 0===a||null===(c=a.month)||void 0===c?void 0:c.toString(),year:null===(u=W.getBirthdate(n))||void 0===u||null===(l=u.year)||void 0===l?void 0:l.toString()},g=d(t.useState(p),2),b=g[0],j=g[1];if(!f)return N();var O,m=function(e,t){var r=e.target.value;if(r){b[t]=r,j(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},b));var i=W.toBirthdate(b),o=V(i);o&&n.dispatchForm({type:y.UPDATE,value:{age:o,birthdate:i}})}},x=function(t,o){var s=2;return t===h.YEAR&&(s=4),e.jsx(i.DateInput,{id:B.getDomId(t,n),name:o,label:r.capitalize(t),unit:t,maxLength:s,minLength:s,defaultValue:b[t],onChange:function(e){return m(e,t)}},void 0)};return O="date_of_birth",e.jsxs(i.DateInputGroup,{children:[x(h.MONTH,O),x(h.DAY,O),x(h.YEAR,O)]},void 0)},ne=function(t){return e.jsx(q,Object.assign({},t,{children:e.jsx(te,Object.assign({},t),void 0)}),void 0)},re=function(e){var t;return void 0===(null==e||null===(t=e.step)||void 0===t?void 0:t.answers)?N("Question and answer are not defined"):W.getRadios(e)},ie=function(t){return e.jsx(q,Object.assign({},t,{children:e.jsx(re,Object.assign({},t),void 0)}),void 0)},oe=function(e){var t;return void 0===(null==e||null===(t=e.step)||void 0===t?void 0:t.answers)?N():W.getCheckboxes(e)},se=function(t){return e.jsx(q,Object.assign({},t,{children:e.jsx(oe,Object.assign({},t),void 0)}),void 0)};function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ue=function(t){var n=t.stepId,r=L().questionnaire.getStepById("".concat(n));return x(a,r.type)?function(t){var n=t.stepId,r=L().questionnaire,i=r.getStepById("".concat(n));if(!x(a,i.type))return N("Not a question");var o=r.getQuestionById(i.id),s=ce({},ce({step:o},t));switch(o.type){case a.DOB:return e.jsx(ne,Object.assign({},s),void 0);case a.MULTIPLE_CHOICE:return e.jsx(ie,Object.assign({},s),void 0);case a.MULTIPLE_SELECT:return e.jsx(se,Object.assign({},s),void 0);default:return N("Question does not exist","QuestionFactory")}}(t):x(c,r.type)?function(t){var n=t.stepId,r=L().questionnaire,i=r.getStepById("".concat(n));if(!x(c,i.type))return N("Not a page");var o=r.getPageById(i.id),s=Z({},Z({step:o},t));switch(o.type){case c.LANDING:return e.jsx(H,Object.assign({},s),void 0);case c.NO_RESULTS:return e.jsx(Y,Object.assign({},s),void 0);case c.RESULTS:return e.jsx(J,Object.assign({},s),void 0);case c.SUMMARY:return e.jsx($,Object.assign({},s),void 0);default:return N("Page does not exist","PageFactory")}}(t):N("Step does not exist","StepFactory")},le=function(t){if(!L().config.dev)return N();return e.jsxs(e.Fragment,{children:[e.jsx(i.Accordion,{items:[{content:e.jsx("pre",{children:e.jsx("code",{children:JSON.stringify(t.form,null,4)},void 0)},void 0),expanded:!1,id:"developer-output",title:"Temporary developer panel"}]},void 0),e.jsx("br",{},void 0),e.jsx("nav",Object.assign({className:"wizard-layout__navbar"},{children:e.jsx(i.Button,Object.assign({type:"reset",secondary:!0,onClick:function(){return U.resetQuestionable(t)}},{children:"Reset"}),void 0)}),void 0)]},void 0)},de=function(t){return e.jsx(i.StepIndicatorStep,{label:t.name,status:t.status},t.id)},ve=function(t){var n=L().questionnaire;return 0===n.getSections(t).length?N():e.jsx(i.StepIndicator,Object.assign({centered:!0,counters:"small"},{children:n.getSections(t).map(de)}),void 0)};exports.Questionable=function(r){var i=r.questionnaire;if(!i)throw new Error("questionable is undefined");var o=d(n.useWizard(i.flow),2),s=o[0],a=o[1],c=d(t.useReducer(D,new S),2),u=c[0],l=c[1];return e.jsxs(C,Object.assign({value:r},{children:[e.jsx("section",{children:e.jsx(ve,Object.assign({},{dispatchForm:l,form:u,stepId:s,wizard:a}),void 0)},void 0),e.jsx("section",Object.assign({className:"section"},{children:e.jsx(ue,Object.assign({},{dispatchForm:l,form:u,stepId:s,wizard:a}),void 0)}),void 0),e.jsx("section",Object.assign({className:"section"},{children:e.jsx(le,Object.assign({},{dispatchForm:l,form:u,stepId:s,wizard:a}),void 0)}),void 0)]}),void 0)};
//# sourceMappingURL=index.js.map
